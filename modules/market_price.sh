#!/bin/bash
# æ¨¡å—ï¼šæ¯æ—¥å¸‚åœºä»·æ ¼ç”Ÿæˆï¼ˆæ–°å¢æ ¸å¿ƒåŠŸèƒ½ï¼‰
# åŠŸèƒ½ï¼šè¥ä¸šå‰ä¸ºæ¯ç§å•†å“ç”Ÿæˆå¸‚åœºä»·ï¼ˆæˆæœ¬ä»·Â±30%æµ®åŠ¨ï¼‰
generate_market_prices() {
    daily_market_prices=()  # æ¸…ç©ºæ˜¨æ—¥å¸‚åœºä»·
    echo "í ½í³Š ä»Šæ—¥å¸‚åœºæŒ‡å¯¼ä»·ç”Ÿæˆä¸­ï¼ˆæˆæœ¬ä»·Â±30%æµ®åŠ¨ï¼‰..."
    echo "---------------------------------------------"

    # ä¸ºæ¯ç§å•†å“ç”Ÿæˆå¸‚åœºä»·
    for i in "${!inventory[@]}"; do
        item=(${inventory[$i]})
        item_name=${item[0]}
        item_cost=${item[2]}  # å•†å“æˆæœ¬ä»·ï¼ˆåˆ†ï¼‰

        # å¸‚åœºä»·è®¡ç®—ï¼šæˆæœ¬ä»·Ã—(70%~130%)ï¼Œå–æ•´æ•°
        local random_ratio=$(( RANDOM % 61 + 70 ))  # 70~130çš„éšæœºæ•°ï¼ˆÂ±30%ï¼‰
        local market_price=$(( item_cost * random_ratio / 100 ))

        # æç«¯æƒ…å†µé˜²æŠ¤ï¼ˆç¡®ä¿å¸‚åœºä»·â‰¥1åˆ†ï¼‰
        if [ $market_price -lt 1 ]; then
            market_price=1
        fi

        # å­˜å‚¨å¸‚åœºä»·ï¼ˆæ ¼å¼ï¼šå•†å“å å¸‚åœºä»·(åˆ†)ï¼‰
        daily_market_prices+=("${item_name} ${market_price}")

        # æ˜¾ç¤ºå¸‚åœºä»·ï¼ˆçº¢è‰²æç¤ºäºæŸé£é™©ï¼‰
        if [ $market_price -lt $item_cost ]; then
            # ç»ˆç«¯æ”¯æŒANSIé¢œè‰²ï¼šçº¢è‰²å­—ä½“æç¤ºäºæŸ
            echo -e "âš ï¸  ${item_name}ï¼šå¸‚åœºä»· $(to_yuan $market_price) å…ƒ < æˆæœ¬ä»· $(to_yuan $item_cost) å…ƒï¼ˆé”€å”®å°†äºæŸï¼‰"
        else
            echo "âœ… ${item_name}ï¼šå¸‚åœºä»· $(to_yuan $market_price) å…ƒï¼ˆæˆæœ¬ä»· $(to_yuan $item_cost) å…ƒï¼‰"
        fi
    done

    echo "---------------------------------------------"
    sleep 2  # åœç•™2ç§’ï¼Œè®©ç©å®¶åˆ¶å®šå®šä»·ç­–ç•¥
}

#!/bin/bash
# 模块：游戏初始化
initialize_game() {
    # 0. 初始化历史记录文件（若不存在则创建）
    local history_file="$(dirname "$0")/history.csv"  # 定位到根目录
    if [ ! -f "$history_file" ]; then
        # 创建文件并写入表头
        echo "日期,经营天数,最终资金,总营收,成就,解锁商品数量,已解锁商品" > "$history_file"
        echo " 已初始化历史记录文件"
    fi
    # 1. 基础资金与开销
    money=10000          # 初始资金：100元（10000分）
    day=1                # 从第1天开始
    daily_expense=1000   # 每日房租：10元（1000分）
    game_over=0          # 游戏未结束
    consecutive_loss_days=0  # 初始无连续亏损

    # 2. 初始库存（5种基础商品：名 数量 成本(分) 初始售价(分)）
    inventory=(
        "苹果 10 200 500"   # 苹果：成本2元，售价5元
        "香蕉 10 100 300"   # 香蕉：成本1元，售价3元
        "面包 5 300 700"    # 面包：成本3元，售价7元
        "牛奶 5 400 900"    # 牛奶：成本4元，售价9元
        "鸡蛋 12 50 200"    # 鸡蛋：成本0.5元，售价2元
    )

    # 3. 可解锁商品配置（名 解锁资金(分) 成本(分) 初始售价(分)）
    unlockable_products=(
        "橙子 15000 150 350"  # 150元解锁：成本1.5元，售价3.5元
        "饮料 25000 250 550"  # 250元解锁：成本2.5元，售价5.5元
        "大米 35000 300 800" # 350元解锁：成本3元，售价8元
        "牛肉 50000 800 1800"  # 500元解锁：成本8元，售价18元
    )
    unlocked_products=()  # 已解锁但未加入库存的商品

    # 4. 成就目标（营收=最终资金-初始100元，单位：分）
    target_basic=50000    # 基础目标：10天内营收≥500元
    target_advanced=100000 # 进阶目标：15天内营收≥1000元
    target_ultimate=200000 # 终极目标：20天内营收≥2000元
    achievement=""        # 初始无成就

    # 初始化提示（告知新功能）
    clear
    echo "============================================="
    echo "            小商店经营模拟器                 "
    echo "============================================="
    echo " 新功能提示："
    echo "1. 每日市场价格浮动（可能低于成本，销售会亏损）"
    echo "2. 盈利超50元需缴阶梯税（10%-30%）"
    echo "3. 成就目标：10天营收≥500元（经营合格）"
    echo "4. 资金达标可解锁新商品（150元解锁橙子）"
    echo "============================================="
    read -p "按回车键开始游戏..."
}

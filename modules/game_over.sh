#!/bin/bash
# æ¨¡å—ï¼šæ¸¸æˆç»“æŸå¤„ç†ï¼ˆæ–°å¢æˆå°±åˆ¤å®šï¼Œæ•´åˆå•†å“è§£é”æ£€æŸ¥ï¼‰
# ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥æ¸¸æˆç»“æŸæ¡ä»¶ï¼ˆäºæŸ/æˆå°±/è§£é”å•†å“ï¼‰
check_game_over() {
    # è®¡ç®—å½“å‰æ€»è¥æ”¶ï¼ˆæœ€ç»ˆèµ„é‡‘-åˆå§‹100å…ƒï¼‰
    local current_revenue=$(( money - 10000 ))

    # æ¡ä»¶1ï¼šèµ„é‡‘ä¸è¶³ä»¥æ”¯ä»˜æ˜æ—¥æˆ¿ç§Ÿï¼ˆç»è¥å¤±è´¥ï¼‰
    if [ $money -lt $daily_expense ]; then
        echo "í ½í²€ èµ„é‡‘ä¸è¶³ä»¥æ”¯ä»˜æ˜æ—¥æˆ¿ç§Ÿï¼ˆéœ€$(to_yuan $daily_expense)å…ƒï¼Œä»…æœ‰$(to_yuan $money)å…ƒï¼‰"
        echo "ç»è¥å¤±è´¥ï¼"
        sleep 3
        game_over=1
        return
    fi

    # æ¡ä»¶2ï¼šè¿ç»­3å¤©äºæŸï¼ˆç»è¥å¤±è´¥ï¼‰
    if [ $after_tax_profit -lt 0 ]; then
        consecutive_loss_days=$(( consecutive_loss_days + 1 ))
        echo "âš ï¸  å·²è¿ç»­${consecutive_loss_days}å¤©äºæŸï¼ˆå†äº$((3-consecutive_loss_days))å¤©ç»è¥å¤±è´¥ï¼‰"
        if [ $consecutive_loss_days -ge 3 ]; then
            echo "í ½í²€ è¿ç»­3å¤©äºæŸï¼Œç»è¥å¤±è´¥ï¼"
            sleep 3
            game_over=1
            return
        fi
    else
        consecutive_loss_days=0  # æœ‰ç›ˆåˆ©åˆ™é‡ç½®
    fi

    # æ¡ä»¶3ï¼šè¾¾æˆæˆå°±ï¼ˆæå‰ç»“æŸï¼Œç»è¥æˆåŠŸï¼‰
    if [ $day -le 10 ] && [ $current_revenue -ge $target_basic ]; then
        achievement="ç»è¥åˆæ ¼"
        echo "í ¼í¿† 10å¤©å†…è¾¾æˆåŸºç¡€ç›®æ ‡ï¼ˆè¥æ”¶â‰¥500å…ƒï¼‰ï¼æˆå°±ï¼š${achievement}"
        sleep 3
        game_over=1
        return
    elif [ $day -le 15 ] && [ $current_revenue -ge $target_advanced ]; then
        achievement="ç»è¥è¾¾äºº"
        echo "í ¼í¿† 15å¤©å†…è¾¾æˆè¿›é˜¶ç›®æ ‡ï¼ˆè¥æ”¶â‰¥1000å…ƒï¼‰ï¼æˆå°±ï¼š${achievement}"
        sleep 3
        game_over=1
        return
    elif [ $day -le 20 ] && [ $current_revenue -ge $target_ultimate ]; then
        achievement="å•†ä¸šå¤§äº¨"
        echo "í ¼í¿† 20å¤©å†…è¾¾æˆç»ˆæç›®æ ‡ï¼ˆè¥æ”¶â‰¥2000å…ƒï¼‰ï¼æˆå°±ï¼š${achievement}"
        sleep 3
        game_over=1
        return
    fi

    # æ¡ä»¶4ï¼š20å¤©æœªè¾¾æˆä»»ä½•æˆå°±ï¼ˆç»è¥å¤±è´¥ï¼‰
    if [ $day -ge 20 ]; then
        echo "í ½í²€ 20å¤©æœªè¾¾æˆåŸºç¡€ç›®æ ‡ï¼ˆè¥æ”¶â‰¥500å…ƒï¼‰ï¼Œç»è¥å¤±è´¥ï¼"
        sleep 3
        game_over=1
        return
    fi

    # æ¯æ—¥è¥ä¸šåæ£€æŸ¥å•†å“è§£é”ï¼ˆæ–°å¢é€»è¾‘ï¼‰
    check_unlock_products
}

# ç¬¬äºŒæ­¥ï¼šæ˜¾ç¤ºæ¸¸æˆç»“æœï¼ˆæˆå°±æ€»ç»“ï¼‰
show_results() {
    clear
    echo "============================================="
    echo "            æ¸¸æˆç»“æŸ - æˆå°±æ€»ç»“"
    echo "============================================="
    echo "ç»è¥å¤©æ•°ï¼š$day å¤©"
    echo "åˆå§‹èµ„é‡‘ï¼š100.00 å…ƒ"
    echo "æœ€ç»ˆèµ„é‡‘ï¼š$(to_yuan $money) å…ƒ"
    echo "æ€»è¥æ”¶ï¼š$(to_yuan $(( money - 10000 ))) å…ƒ"
    echo "è§£é”å•†å“ï¼š${#unlocked_products[@]} ç§"
    [ ${#unlocked_products[@]} -gt 0 ] && echo "å·²è§£é”å•†å“ï¼š${unlocked_products[*]}"
    echo "---------------------------------------------"

    # æˆå°±è¯¦æƒ…å±•ç¤º
    if [ "$achievement" = "å•†ä¸šå¤§äº¨" ]; then
        echo -e "í ¼í¿† æœ€ç»ˆæˆå°±ï¼šå•†ä¸šå¤§äº¨"
        echo "í ¼í¾‰ æ­å–œï¼ä½ æ˜¯å¤©ç”Ÿçš„å•†äººï¼20å¤©å†…è¥æ”¶çªç ´2000å…ƒï¼Œç²¾é€šå¸‚åœºåšå¼ˆä¸æˆæœ¬æ§åˆ¶ï¼"
    elif [ "$achievement" = "ç»è¥è¾¾äºº" ]; then
        echo -e "í ¼í¿† æœ€ç»ˆæˆå°±ï¼šç»è¥è¾¾äºº"
        echo "í ½í± ä¼˜ç§€ï¼15å¤©å†…è¥æ”¶çªç ´1000å…ƒï¼Œä½ çš„ç»è¥ç­–ç•¥å·²å…·å¤‡ä¸“ä¸šæ°´å‡†ï¼"
    elif [ "$achievement" = "ç»è¥åˆæ ¼" ]; then
        echo -e "í ¼í¿† æœ€ç»ˆæˆå°±ï¼šç»è¥åˆæ ¼"
        echo "âœ… ä¸é”™ï¼10å¤©å†…è¥æ”¶çªç ´500å…ƒï¼ŒåŸºæœ¬ç»è¥èƒ½åŠ›è¾¾æ ‡ï¼Œç»§ç»­åŠ æ²¹å¯å†²å‡»æ›´é«˜æˆå°±ï¼"
    else
        echo -e "âŒ æœ€ç»ˆæˆå°±ï¼šæœªè¾¾æˆ"
        echo "í ½í²¡ å¤±è´¥åŸå› åˆ†æï¼š"
        if [ $consecutive_loss_days -ge 3 ]; then
            echo "   - è¿ç»­3å¤©äºæŸï¼ˆéœ€å…³æ³¨å¸‚åœºä»·æ³¢åŠ¨ï¼Œé¿å…äºæœ¬é”€å”®ï¼‰"
        elif [ $day -ge 20 ]; then
            echo "   - 20å¤©æœªè¾¾æˆ500å…ƒè¥æ”¶ï¼ˆéœ€ä¼˜åŒ–å®šä»·ç­–ç•¥ï¼Œä¼˜å…ˆè§£é”é«˜åˆ©æ¶¦å•†å“ï¼‰"
        else
            echo "   - èµ„é‡‘ä¸è¶³ä»¥æ”¯ä»˜æˆ¿ç§Ÿï¼ˆéœ€æ§åˆ¶æˆæœ¬ï¼Œé¿å…è¿‡åº¦è¿›è´§ï¼‰"
        fi
        echo "í ½í²¡ å»ºè®®ï¼šå¤šå…³æ³¨å¸‚åœºæŒ‡å¯¼ä»·ï¼Œç›ˆåˆ©è¶…50å…ƒæ—¶æ³¨æ„ç¨æ¬¾å½±å“ï¼"
    fi
    echo "============================================="
    read -p "æŒ‰å›è½¦é”®é€€å‡ºæ¸¸æˆ..."
}
